# Dovecot configuration for LMTP service
service lmtp {
  unix_listener /var/spool/postfix/private/dovecot-lmtp {
    mode = 0600
    user = postfix
    group = postfix
  }
}

# Enable SASL authentication service for Postfix
service auth {
  unix_listener /var/spool/postfix/private/auth {
    mode = 0666
    user = postfix
    group = postfix
  }
}

# Disable plaintext authentication for security
# Note: This is a basic configuration; consider using SSL/TLS for secure connections.
disable_plaintext_auth = no

# Mailbox configuration - using virtual users
mail_location = maildir:/var/mail/vmail/%n
mail_uid = 5000
mail_gid = 8

# Auth mechanism is set to plain
auth_mechanisms = plain login oauthbearer xoauth2

# Dovecot configuration for IMAP service
protocols = imap lmtp

ssl = required

# Point to your Letâ€™s Encrypt certificates
ssl_cert = </etc/letsencrypt/live/aravindahwk.org/fullchain.pem
ssl_key = </etc/letsencrypt/live/aravindahwk.org/privkey.pem

# Optional: restrict protocols to modern TLS
ssl_protocols = !SSLv2 !SSLv3
ssl_min_protocol = TLSv1.2
ssl_cipher_list = HIGH:!aNULL:!MD5

passdb {
  driver = lua
  args = file=/etc/dovecot/auth.lua blocking=yes
}

userdb {
  driver = lua
  args = file=/etc/dovecot/auth.lua blocking=yes
}


# IMAP service configuration
service imap-login {
  inet_listener imap {
    port = 143
  }

  inet_listener imaps {
    port = 993
    ssl = yes
  }
}

log_path = /dev/stderr
info_log_path = /dev/stderr
debug_log_path = /dev/stderr

auth_debug = yes
auth_debug_passwords = yes
auth_verbose = yes
auth_verbose_passwords = yes
mail_debug = yes